"use strict";(self.webpackChunkcad_ocjs=self.webpackChunkcad_ocjs||[]).push([[730],{730:(e,t,n)=>{var o=n(514),a=n(387),r=n(525);const s={setOpenCascade(e){this.openCascade=e},tessellate(e){const t=[];new this.openCascade.BRepMesh_IncrementalMesh_2(e,.1,!1,.5,!1);const n=new this.openCascade.TopExp_Explorer_1;for(n.Init(e,this.openCascade.TopAbs_ShapeEnum.TopAbs_FACE,this.openCascade.TopAbs_ShapeEnum.TopAbs_SHAPE);n.More();n.Next()){const e=this.openCascade.TopoDS.Face_1(n.Current()),o=new this.openCascade.TopLoc_Location_1,a=this.openCascade.BRep_Tool.Triangulation(e,o,0);if(a.IsNull())continue;const r={vertex_coord:[],normal_coord:[],tri_indexes:[],number_of_triangles:0},s=new this.openCascade.Poly_Connect_2(a),i=a.get();r.vertex_coord=new Array(3*i.NbNodes());for(let e=1;e<=i.NbNodes();e++){const t=i.Node(e).Transformed(o.Transformation());r.vertex_coord[3*(e-1)+0]=t.X(),r.vertex_coord[3*(e-1)+1]=t.Y(),r.vertex_coord[3*(e-1)+2]=t.Z()}const c=new this.openCascade.TColgp_Array1OfDir_2(1,i.NbNodes());this.openCascade.StdPrs_ToolTriangulatedShape.Normal(e,s,c),r.normal_coord=new Array(3*c.Length());for(let e=c.Lower();e<=c.Upper();e++){const t=c.Value(e).Transformed(o.Transformation());r.normal_coord[3*(e-1)+0]=t.X(),r.normal_coord[3*(e-1)+1]=t.Y(),r.normal_coord[3*(e-1)+2]=t.Z()}const l=e.Orientation_1(),d=a.get().Triangles();r.tri_indexes=new Array(3*d.Length());let p=0;for(let e=1;e<=a.get().NbTriangles();e++){const t=d.Value(e);let n=t.Value(1),o=t.Value(2),a=t.Value(3);if(l!==this.openCascade.TopAbs_Orientation.TopAbs_FORWARD){let e=n;n=o,o=e}r.tri_indexes[3*p+0]=n,r.tri_indexes[3*p+1]=o,r.tri_indexes[3*p+2]=a,p++}r.number_of_triangles=p,t.push(r)}return t},joinPrimitives(e){let t=0,n=0,o=0,a=0;const r=[],s=[],i=[];return e.forEach((e=>{for(let n=0;n<e.vertex_coord.length/3;n++)r[3*t+0]=e.vertex_coord[3*n+0],r[3*t+1]=e.vertex_coord[3*n+1],r[3*t+2]=e.vertex_coord[3*n+2],t++;for(let t=0;t<e.normal_coord.length/3;t++)s[3*n+0]=e.normal_coord[3*t+0],s[3*n+1]=e.normal_coord[3*t+1],s[3*n+2]=e.normal_coord[3*t+2],n++;for(let t=0;t<e.tri_indexes.length/3;t++)i[3*o+0]=e.tri_indexes[3*t+0]+a-1,i[3*o+1]=e.tri_indexes[3*t+1]+a-1,i[3*o+2]=e.tri_indexes[3*t+2]+a-1,o++;a=t})),[r,s,i]},objGetTriangle(e,t){const n=3*t[3*e+0],o=3*t[3*e+1],a=3*t[3*e+2];return[[n,o,a],[n,o,a],[n,o,a]]},generateGeometry(e,t,n,a){const r=[],s=[];function i(e,t,n){r.push(new o.Pq0(e,t,n))}for(let n=0;n<e;n++){const[e,,]=this.objGetTriangle(n,a);i(t[e[0]+0],t[e[0]+1],t[e[0]+2]),i(t[e[1]+0],t[e[1]+1],t[e[1]+2]),i(t[e[2]+0],t[e[2]+1],t[e[2]+2])}for(let t=0;t<e;t++){const[,e]=this.objGetTriangle(t,a);c=0+3*t,l=1+3*t,d=2+3*t,p=n[e[0]+0],u=n[e[0]+1],g=n[e[0]+2],w=n[e[1]+0],m=n[e[1]+1],h=n[e[1]+2],_=n[e[2]+0],f=n[e[2]+1],C=n[e[2]+2],s.push(new o.nFj(c,l,d,[new o.Pq0(p,u,g),new o.Pq0(w,m,h),new o.Pq0(_,f,C)]))}var c,l,d,p,u,g,w,m,h,_,f,C;return[r,s]}};let i,c,l,d,p;function u(e,t){const n=document.createElement("canvas"),a=128;n.width=a,n.height=a;const r=n.getContext("2d");r.fillStyle=t,r.fillRect(0,0,a,a),r.font="Bold 51.2px Arial",r.fillStyle="white",r.textAlign="center",r.textBaseline="middle",r.fillText(e,64,64);const s=new o.GOR(n);return s.needsUpdate=!0,s}const g=async(e,t,n,o)=>{const r=(0,a.ti)(t),s=`file.${r}`;await(0,a.xc)(t).then((async a=>{e.FS.createDataFile("/",s,a,!0,!0);var i=null;if("step"===r?i=new e.STEPControl_Reader_1:"iges"===r?i=new e.IGESControl_Reader_1:console.error("opencascade.js can't parse this extension! (yet)"),i.ReadFile(s)===e.IFSelect_ReturnStatus.IFSelect_RetDone){console.log("file loaded successfully!     Converting to OCC now..."),i.TransferRoots(new e.Message_ProgressRange_1);const a=i.OneShape();console.log(t.name+" converted successfully!  Triangulating now..."),o.remove(o.getObjectByName("shape")),await n(e,a,o),console.log(t.name+" triangulated and added to the scene!"),e.FS.unlink(`/file.${r}`)}else console.error("Something in OCCT went wrong trying to read "+t.name)}))},w=async(e,t,n)=>{s.setOpenCascade(e);const a=await s.tessellate(t),[r,i,c]=await s.joinPrimitives(a),l=a.reduce(((e,t)=>e+t.number_of_triangles),0),[d,p]=await s.generateGeometry(l,r,i,c),u=new o._4j({color:new o.Q1f(.9,.9,.9)}),g=new o.V23;g.vertices=d,g.faces=p;const w=new o.eaF(g,u);console.log(w),w.name="shape",w.rotation.x=-Math.PI/2,n.add(w)},m=(()=>{var e=new o.Z58;e.background=new o.Q1f(15658734);var t=new o.ubm(75,window.innerWidth/window.innerHeight,.1,1e6),n=new o.JeP({antialias:!0});const a=document.getElementById("viewport");n.setSize(a.clientWidth,a.clientHeight),n.setPixelRatio(window.devicePixelRatio),a.appendChild(n.domElement);const s=new o.$p8(4210752,2);e.add(s);const u=new o.ZyN(16777215,1.5);u.position.set(50,100,75),e.add(u);const g=new o.ZyN(16777215,1);g.position.set(-50,-50,-50),e.add(g),t.position.set(0,50,100);const w=new r.N(t,n.domElement);return w.screenSpacePanning=!0,w.target.set(0,0,0),w.enableDamping=!0,w.dampingFactor=.05,w.update(),function o(){requestAnimationFrame(o),w.update(),n.render(e,t),function(){if(!l||!p)return;const e=p.quaternion.clone().invert();d.quaternion.copy(e),l.render(i,c)}()}(),window.addEventListener("resize",(function(){const e=document.getElementById("viewport");if(!e)return;const o=e.clientWidth,a=e.clientHeight;t.aspect=o/a,t.updateProjectionMatrix(),n.setSize(o,a)})),{scene:e,camera:t,controls:w,renderer:n}})();if(m){const{scene:h,camera:_,controls:f,renderer:C}=m;function x(){const e=h.getObjectByName("shape");if(e&&f){const t=(new o.NRn).setFromObject(e),n=t.getCenter(new o.Pq0),a=t.getSize(new o.Pq0);f.target.copy(n);const r=Math.max(a.x,a.y,a.z),s=_.fov*(Math.PI/180);let i=Math.abs(r/2/Math.tan(s/2));i*=1.5;const c=(new o.Pq0).subVectors(_.position,f.target).normalize();0===c.lengthSq()?(_.position.copy(n),_.position.z+=i):_.position.copy(n).addScaledVector(c,i),f.update(),console.log("Camera target set to model center:",n)}else e||console.warn("Could not find model named 'shape' to focus on."),f||console.warn("OrbitControls not available to update target."),f?.target.set(0,0,0),f?.update()}!function(e){p=e;const t=document.getElementById("viewcube-container");if(!t)return void console.error("ViewCube container not found!");l=new o.JeP({alpha:!0,antialias:!0}),l.setSize(100,100),l.setPixelRatio(window.devicePixelRatio),t.appendChild(l.domElement),i=new o.Z58,c=new o.qUd(-.75,.75,.75,-.75,.1,100),c.position.z=5,new o.Tap;const n=[u("+X","rgb(255, 100, 100)"),u("-X","rgb(255, 150, 150)"),u("+Y","rgb(100, 255, 100)"),u("-Y","rgb(150, 255, 150)"),u("+Z","rgb(100, 100, 255)"),u("-Z","rgb(150, 150, 255)")].map((e=>new o.V9B({map:e,side:o.$EB}))),a=new o.iNn(1,1,1);d=new o.eaF(a,n),i.add(d);const r=new o.IzY(.8);i.add(r)}(_),(0,a.PA)().then((e=>{const t=document.getElementById("step-file");t?t.addEventListener("input",(async t=>{t.target.files.length>0&&(await g(e,t.target.files[0],w,h),x(),t.target.value="")})):console.warn("File input element not found.");const n=document.getElementsByClassName("test");for(const t of n)t.addEventListener("click",(async t=>{const n=t.target.name;try{const t=await fetch(n).then((e=>{if(!e.ok)throw new Error(`Failed to fetch ${n}: ${e.statusText}`);return e.blob()})),o=new File([t],n,{type:"application/octet-stream"});await g(e,o,w,h),x()}catch(e){console.error("Error loading test file:",e);const t=document.getElementById("result");t&&(t.textContent=`Error loading ${n}: ${e.message}`)}}))})).catch((e=>{console.error("Failed to initialize OpenCascade:",e);const t=document.getElementById("result");t&&(t.textContent="CAD 라이브러리를 초기화하는 데 실패했습니다.")}))}else console.error("Failed to initialize Three.js viewport.")}}]);
//# sourceMappingURL=730.22a81f779f2e7f59d0f2.bundle.js.map