(()=>{"use strict";var e,t={362:(e,t,n)=>{var o=n(514),i=n(525),a=n(365);let r,s,c,l,d;function m(e,t){const n=document.createElement("canvas"),i=128;n.width=i,n.height=i;const a=n.getContext("2d");a.fillStyle=t,a.fillRect(0,0,i,i),a.font="Bold 51.2px Arial",a.fillStyle="white",a.textAlign="center",a.textBaseline="middle",a.fillText(e,64,64);const r=new o.GOR(n);return r.needsUpdate=!0,r}const u={isControlsEnabled:!0,isSelectionMode:!1,selectedParts:[]},p=(e,t)=>{const{scene:n}=e,i=document.getElementById("info");return i.textContent="모델 로딩 중...",new Promise(((e,r)=>{(new a.B).load(t,(t=>{const a=n.getObjectByName("model");a&&n.remove(a);const r=t.scene;r.name="model";let s=0;r.traverse((e=>{e.isMesh&&(++s,e.userData.selectable=!0,e.userData.originalMaterial=e.material.clone(),e.userData.partInfo={id:s,name:e.name,vertexCount:e.geometry.attributes.position.count,triangleCount:e.geometry.index?e.geometry.index.count/3:0})})),n.add(r);const c=(new o.NRn).setFromObject(r),l=c.getSize(new o.Pq0),d=c.getCenter(new o.Pq0);i.innerHTML=`\n          <div>\n            <p><strong>모델 로드 완료</strong></p>\n            <p>크기: ${l.x.toFixed(2)} × ${l.y.toFixed(2)} × ${l.z.toFixed(2)}</p>\n            <p>중심점: (${d.x.toFixed(2)}, ${d.y.toFixed(2)}, ${d.z.toFixed(2)})</p>\n            <p>부품 수: ${s}개</p>\n          </div>\n        `,e(r)}),(e=>{const t=e.loaded/e.total*100;i.textContent=`로딩 중: ${t.toFixed(0)}%`}),(e=>{i.textContent=`모델 로드 오류: ${e.message}`,console.error("GLB 모델 로드 오류:",e),r(e)}))}))},g=e=>{const{scene:t,camera:n,controls:i}=e,a=t.getObjectByName("model");if(a&&i){const e=(new o.NRn).setFromObject(a),t=e.getCenter(new o.Pq0),r=e.getSize(new o.Pq0);i.target.copy(t);const s=Math.max(r.x,r.y,r.z),c=n.fov*(Math.PI/180);let l=Math.abs(s/2/Math.tan(c/2));l*=1.5;const d=(new o.Pq0).subVectors(n.position,i.target).normalize();0===d.lengthSq()?(n.position.copy(t),n.position.z+=l):n.position.copy(t).addScaledVector(d,l),i.update()}},h=(e,t)=>{if(!t)return;const{camera:n,controls:i}=e,a=(new o.NRn).setFromObject(t),r=a.getCenter(new o.Pq0),s=a.getSize(new o.Pq0);i.target.copy(r);const c=Math.max(s.x,s.y,s.z),l=n.fov*(Math.PI/180);let d=Math.abs(c/2/Math.tan(l/2));d*=3;const m=(new o.Pq0).subVectors(n.position,i.target).normalize();0===m.lengthSq()?(n.position.copy(r),n.position.z+=d):n.position.copy(r).addScaledVector(m,d),i.update()};document.addEventListener("DOMContentLoaded",(()=>{const e=(()=>{const e=new o.Z58;e.background=new o.Q1f(15658734);const t=document.getElementById("viewport"),n=new o.ubm(75,t.clientWidth/t.clientHeight,.1,1e3);n.position.set(0,0,5);const a=new o.JeP({antialias:!0});a.setSize(t.clientWidth,t.clientHeight),a.setPixelRatio(window.devicePixelRatio),a.outputEncoding=o.S2Q,t.appendChild(a.domElement);const m=new o.$p8(4210752,2);e.add(m);const u=new o.ZyN(16777215,1.5);u.position.set(1,1,1),e.add(u);const p=new o.ZyN(16777215,1);p.position.set(-1,-1,-1),e.add(p);const g=new i.N(n,a.domElement);return g.screenSpacePanning=!0,g.enableDamping=!0,g.dampingFactor=.05,g.target.set(0,0,0),g.update(),window.addEventListener("resize",(()=>{const e=document.getElementById("viewport");if(!e)return;const t=e.clientWidth,o=e.clientHeight;n.aspect=t/o,n.updateProjectionMatrix(),a.setSize(t,o)})),function t(){requestAnimationFrame(t),g.update(),a.render(e,n),function(){if(!c||!d)return;const e=d.quaternion.clone().invert();l.quaternion.copy(e),c.render(r,s)}()}(),{scene:e,camera:n,controls:g,renderer:a}})(),{camera:t,renderer:n,controls:a}=e;!function(e){d=e;const t=document.getElementById("viewcube-container");if(!t)return void console.error("ViewCube container not found!");c=new o.JeP({alpha:!0,antialias:!0}),c.setSize(100,100),c.setPixelRatio(window.devicePixelRatio),t.appendChild(c.domElement),r=new o.Z58,s=new o.qUd(-.75,.75,.75,-.75,.1,100),s.position.z=5,new o.Tap;const n=[m("+X","rgb(255, 100, 100)"),m("-X","rgb(255, 150, 150)"),m("+Y","rgb(100, 255, 100)"),m("-Y","rgb(150, 255, 150)"),m("+Z","rgb(100, 100, 255)"),m("-Z","rgb(150, 150, 255)")].map((e=>new o.V9B({map:e,side:o.$EB}))),i=new o.iNn(1,1,1);l=new o.eaF(i,n),r.add(l);const a=new o.IzY(.8);r.add(a)}(t);const v=(e=>{const{scene:t,camera:n,renderer:i,controls:a}=e,r=i.domElement,s=new o.tBo,c=new o.I9Y;let l=null,d=null;const m=document.getElementById("toggle-mode");m&&m.addEventListener("click",(()=>{u.isSelectionMode=!u.isSelectionMode,a.enabled=!u.isSelectionMode,m.textContent=u.isSelectionMode?"모드: 부품 선택":"모드: 카메라 이동",u.isSelectionMode?(m.classList.add("active"),r.style.cursor="crosshair"):(m.classList.remove("active"),r.style.cursor="grab",v())}));const p=(e,t)=>{const n=e.clone(),i=t?new o.Q1f(2201331):new o.Q1f(16771899);return n.color&&n.color.set(i),void 0!==n.opacity&&(n.opacity=.8,n.transparent=!0),n.emissive=new o.Q1f(t?870305:16761095),n.emissiveIntensity=.5,n},g=()=>{l&&(l.material=l.userData.originalMaterial.clone(),l=null,u.selectedParts=[])},v=()=>{d&&d!==l&&(d.material=d.userData.originalMaterial.clone(),d=null)},f=()=>{const n=t.getObjectByName("model"),o=document.getElementById("parts-list");if(!o||!n)return;o.innerHTML="";const i=[];if(n.traverse((e=>{e.isMesh&&e.userData.selectable&&i.push(e)})),0===i.length){const e=document.createElement("li");return e.textContent="선택 가능한 부품이 없습니다.",void o.appendChild(e)}i.sort(((e,t)=>e.name.localeCompare(t.name))).forEach((t=>{const n=document.createElement("li");n.textContent=t.name,n.title=`정점: ${t.userData.partInfo?.vertexCount??0}, 삼각형: ${t.userData.partInfo?.triangleCount??0}`,n.style.cursor="pointer",n.addEventListener("click",(()=>{g(),l=t,t.material=p(t.userData.originalMaterial,!0),h(e,t),o.querySelectorAll("li").forEach((e=>e.classList.remove("selected"))),n.classList.add("selected"),u.selectedParts=[t]})),o.appendChild(n)}))};r.addEventListener("mousemove",(e=>{if(u.isSelectionMode){const o=r.getBoundingClientRect();c.x=(e.clientX-o.left)/r.clientWidth*2-1,c.y=-(e.clientY-o.top)/r.clientHeight*2+1,s.setFromCamera(c,n);const i=t.getObjectByName("model");if(!i)return;const a=s.intersectObjects(i.children,!0);if(v(),a.length>0){const e=a[0].object;e&&e.userData&&e.userData.selectable&&(e!==l&&(d=e,e.material=p(e.userData.originalMaterial,!1)),r.style.cursor="pointer")}else r.style.cursor="crosshair"}})),r.addEventListener("click",(e=>{if(u.isSelectionMode){const o=r.getBoundingClientRect();c.x=(e.clientX-o.left)/r.clientWidth*2-1,c.y=-(e.clientY-o.top)/r.clientHeight*2+1,s.setFromCamera(c,n);const i=t.getObjectByName("model");if(!i)return;const a=s.intersectObjects(i.children,!0);if(g(),a.length>0){const e=a[0].object;if(e&&e.userData&&e.userData.selectable){l=e,e.material=p(e.userData.originalMaterial,!0),u.selectedParts=[e];const t=document.getElementById("parts-list");t&&t.querySelectorAll("li").forEach((t=>{t.textContent===e.name?(t.classList.add("selected"),t.scrollIntoView({behavior:"smooth",block:"nearest"})):t.classList.remove("selected")}))}}}})),document.addEventListener("keydown",(t=>{if("Shift"===t.key){const e=u.isSelectionMode;u.isSelectionMode=!u.isSelectionMode,a.enabled=!u.isSelectionMode,r.style.cursor=u.isSelectionMode?"crosshair":"grab",u.isSelectionMode||v(),r.dataset.tempModeChange=e.toString()}else if("f"===t.key&&l)h(e,l);else if("Escape"===t.key){g();const e=document.getElementById("parts-list");e&&e.querySelectorAll("li").forEach((e=>e.classList.remove("selected")))}})),document.addEventListener("keyup",(e=>{"Shift"===e.key&&r.dataset.tempModeChange&&(u.isSelectionMode="true"===r.dataset.tempModeChange,a.enabled=!u.isSelectionMode,r.style.cursor=u.isSelectionMode?"crosshair":"grab",delete r.dataset.tempModeChange)}));const y=document.getElementById("clear-selection");return y&&y.addEventListener("click",(()=>{g();const e=document.getElementById("parts-list");e&&e.querySelectorAll("li").forEach((e=>e.classList.remove("selected")))})),document.addEventListener("model-loaded",f),{resetSelection:g,updatePartsList:f,focusOnPart:h}})(e);document.getElementById("load-model").addEventListener("click",(async()=>{try{await p(e,"/AntiqueCamera.glb"),g(e),v.updatePartsList(),document.dispatchEvent(new Event("model-loaded"))}catch(e){console.error("모델 로드 실패:",e)}})),document.getElementById("reset-view").addEventListener("click",(()=>{g(e)})),p(e,"/AntiqueCamera.glb").then((()=>{g(e),v.updatePartsList(),document.dispatchEvent(new Event("model-loaded"))})).catch((e=>{console.error("초기 모델 로드 실패:",e)}))}))}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.m=t,e=[],o.O=(t,n,i,a)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,i,a]=e[d],s=!0,c=0;c<n.length;c++)(!1&a||r>=a)&&Object.keys(o.O).every((e=>o.O[e](n[c])))?n.splice(c--,1):(s=!1,a<r&&(r=a));if(s){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,i,a]},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={721:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var i,a,[r,s,c]=n,l=0;if(r.some((t=>0!==e[t]))){for(i in s)o.o(s,i)&&(o.m[i]=s[i]);if(c)var d=c(o)}for(t&&t(n);l<r.length;l++)a=r[l],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(d)},n=self.webpackChunkcad_ocjs=self.webpackChunkcad_ocjs||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=o.O(void 0,[525,365],(()=>o(362)));i=o.O(i)})();
//# sourceMappingURL=glb_viewer.734b66f72481f84e33d1.bundle.js.map